
DROP TABLE IF EXISTS #TEMP_ENTRADA_FISCAL

SELECT TOP  1
  A.PEDIDO,
  B.PRODUTO,
  B.COR_PRODUTO,
  C.NOME_CLIFOR,
  C.ROMANEIO_PRODUTO,
  D.FILIAL,
  C.RESPONSAVEL,
  C.NF_ENTRADA,
  E.CHAVE_NFE
INTO #TEMP_ENTRADA_FISCAL
FROM
COMPRAS A INNER JOIN COMPRAS_PRODUTO B ON A.PEDIDO = B.PEDIDO
          INNER JOIN ESTOQUE_PROD_ENT C ON A.PEDIDO = C.PEDIDO
          INNER JOIN ESTOQUE_PROD1_ENT D ON B.PRODUTO = D.PRODUTO
          INNER JOIN ENTRADAS E ON E.NF_ENTRADA = C.NF_ENTRADA
WHERE
E.CHAVE_NFE = '3524080027565500017255056000034055109W9243934'
AND D.FILIAL LIKE '%AMOSTRA%'

IF NOT EXISTS (SELECT * FROM #TEMP_ENTRADA_FISCAL)
  RAISERROR('A entrada Fiscal desta chave NFE n√£o foi localizada', 16,2)





SELECT DISTINCT  
  B.ITEM_XML ItemXML,
  B.PEDIDO Pedido,
  B.PRODUTO Produto,
  B.COR_PRODUTO CorProduto,
  B.TAMANHO Tamanho,
  B.QUANTIDADE Quantidade
FROM
ENTRADAS_FISICAS_PROCESSAMENTO A 
INNER JOIN ENTRADAS_FISICAS_PROCESSAMENTO_ITEMS B ON A.CHAVE_NFE = B.CHAVE_NFE
WHERE A.STATUS_PROCESSAMENTO = 2
